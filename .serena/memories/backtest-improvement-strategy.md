# 백테스트 손익률 개선 전략

## 목표
나스닥 51~100위 종목 주봉 백테스트 연 평균 손익률 7% 이상 달성

## 개선 전/후 비교
| 지표 | 개선 전 | 개선 후 |
|------|---------|---------|
| 연 평균 손익률 | 3.30% | **7.08%** |
| 평균 승률 | 68.0% | **75.0%** |
| 총 투자 | $125,000 | $34,000 |

## 효과적인 개선 방법

### 1. 추세 필터 (patterns.ts)
```typescript
function calculateTrend(data, index, period = 20) {
  // 현재 SMA vs 과거 SMA 비교
  // 양수=상승추세, 음수=하락추세
}
```
- 하락추세(-5% 이상)에서 매수 신호 차단: `if (trend < -0.05) return null`
- 상승추세 신뢰도 보너스: +10% ~ +25%
- 하락추세 신뢰도 페널티: -15% ~ -20%

### 2. 신뢰도 기반 포지션 사이징 (simulator.ts)
```typescript
const scaledSize = params.positionSize * Math.pow(signal.confidence / 70, 2);
```
- 신뢰도 70% 기준으로 스케일링
- 지수 2 적용 (공격적 스케일링)
- 고신뢰도 신호에 더 큰 포지션 배분

### 3. 최적 파라미터
- `minConfidence: 85` - 저품질 신호 필터링
- `confidenceScaling: true` - 포지션 사이징 활성화

## 효과 없었던 방법
- 손절(stopLoss): 너무 빨리 발동되어 수익 감소
- 익절(takeProfit): 수익 기회 조기 차단
- BB 이탈 깊이 필터: 좋은 신호도 차단
- 추세 기간 단축(20→10): 거래 수 급감

## 손실 종목 특성 (참고)
| 티커 | 추세 | 특징 |
|------|------|------|
| BIIB | -42% | 강한 하락추세 |
| GFS | -41% | 강한 하락추세, 높은 변동성 |
| ON | -34% | 갭 빈도 높음 (31회) |
| KHC | -37% | 강한 하락추세 |

→ 공통점: 모두 강한 하락추세 종목. 추세 필터로 대부분 차단됨.

## 핵심 인사이트
1. **추세 방향이 가장 중요** - 하락추세 역매매는 손실 확률 높음
2. **신뢰도 스케일링이 효과적** - 확실한 신호에 집중 투자
3. **거래 수 감소는 괜찮음** - 품질 > 수량
